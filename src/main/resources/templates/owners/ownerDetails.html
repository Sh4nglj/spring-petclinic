<!DOCTYPE html>

<html xmlns:th="https://www.thymeleaf.org" th:replace="~{fragments/layout :: layout (~{::body},'owners')}">

<body>

  <h2 th:text="#{ownerInformation}">Owner Information</h2>

  <div th:if="${message}" class="alert alert-success" id="success-message">
    <span th:text="${message}"></span>
  </div>

  <div th:if="${error}" class="alert alert-danger" id="error-message">
    <span th:text="${error}"></span>
  </div>

  <table class="table table-striped" th:object="${owner}">
    <tr>
      <th th:text="#{name}">Name</th>
      <td><b th:text="*{firstName + ' ' + lastName}"></b></td>
    </tr>
    <tr>
      <th th:text="#{address}">Address</th>
      <td th:text="*{address}"></td>
    </tr>
    <tr>
      <th th:text="#{city}">City</th>
      <td th:text="*{city}"></td>
    </tr>
    <tr>
      <th th:text="#{telephone}">Telephone</th>
      <td th:text="*{telephone}"></td>
    </tr>
  </table>

  <a th:href="@{__${owner.id}__/edit}" class="btn btn-primary" th:text="#{editOwner}">Edit
    Owner</a>
  <a th:href="@{__${owner.id}__/pets/new}" class="btn btn-primary" th:text="#{addNewPet}">Add
    New Pet</a>

  <br />
  <br />
  <br />
  <!-- Nav tabs -->
  <ul class="nav nav-tabs">
    <li class="active"><a href="#petsAndVisits" data-toggle="tab" th:text="#{petsAndVisits}">Pets and Visits</a></li>
    <li><a href="#healthRecords" data-toggle="tab">健康档案</a></li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <!-- Pets and Visits tab -->
    <div class="tab-pane active" id="petsAndVisits">
      <table class="table table-striped">
        <tr th:each="pet : ${owner.pets}">
          <td valign="top">
            <dl class="dl-horizontal">
              <dt th:text="#{name}">Name</dt>
              <dd th:text="${pet.name}"></dd>
              <dt th:text="#{birthDate}">Birth Date</dt>
              <dd th:text="${#temporals.format(pet.birthDate, 'yyyy-MM-dd')}"></dd>
              <dt th:text="#{type}">Type</dt>
              <dd th:text="${pet.type}"></dd>
            </dl>
          </td>
          <td valign="top">
            <table class="table-condensed">
              <thead>
                <tr>
                  <th th:text="#{visitDate}">Visit Date</th>
                  <th th:text="#{description}">Description</th>
                </tr>
              </thead>
              <tr th:each="visit : ${pet.visits}">
                <td th:text="${#temporals.format(visit.date, 'yyyy-MM-dd')}"></td>
                <td th:text="${visit?.description}"></td>
              </tr>
              <tr>
                <td><a th:href="@{__${owner.id}__/pets/__${pet.id}__/edit}" th:text="#{editPet}">Edit Pet</a></td>
                <td><a th:href="@{__${owner.id}__/pets/__${pet.id}__/visits/new}" th:text="#{addVisit}">Add Visit</a></td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </div>
    
    <!-- Health Records tab -->
    <div class="tab-pane" id="healthRecords">
      <h3>宠物健康档案</h3>
      
      <div th:each="pet : ${owner.pets}">
        <h4 th:text="${pet.name}"></h4>
        
        <!-- Vaccination status summary -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">疫苗接种状态</h3>
          </div>
          <div class="panel-body">
            <div th:if="${pet.visits.isEmpty()}" class="alert alert-info">
              暂无疫苗接种记录
            </div>
            <div th:unless="${pet.visits.isEmpty()}">
              <div th:each="visit : ${pet.visits}" th:if="${visit.vaccinationStatus != null}" th:with="currentVisit=${visit}" th:break="${true}">
                <div th:switch="${currentVisit.vaccinationStatus}">
                  <div th:case="FULLY_VACCINATED" class="alert alert-success">
                    <strong>已接种</strong> - 最近接种日期: <span th:text="${#temporals.format(currentVisit.vaccinationDate, 'yyyy-MM-dd')}"></span>
                  </div>
                  <div th:case="NOT_VACCINATED" class="alert alert-danger">
                    <strong>未接种</strong>
                  </div>
                  <div th:case="PARTIALLY_VACCINATED" class="alert alert-warning">
                    <strong>部分接种</strong> - 最近接种日期: <span th:text="${#temporals.format(currentVisit.vaccinationDate, 'yyyy-MM-dd')}"></span>
                  </div>
                  <div th:case="VACCINATION_EXPIRED" class="alert alert-danger">
                    <strong>免疫期已过</strong> - 最近接种日期: <span th:text="${#temporals.format(currentVisit.vaccinationDate, 'yyyy-MM-dd')}"></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Vaccination history -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">疫苗接种历史记录</h3>
          </div>
          <div class="panel-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>接种日期</th>
                  <th>疫苗名称</th>
                  <th>接种状态</th>
                  <th>医生</th>
                  <th>备注</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="visit : ${pet.visits}" th:if="${visit.vaccinationStatus != null}">
                  <td th:text="${#temporals.format(visit.date, 'yyyy-MM-dd')}"></td>
                  <td th:text="${visit.description}"></td>
                  <td th:text="${visit.vaccinationStatus.displayName}"></td>
                  <td>未记录</td>
                  <td></td>
                  <td>
                    <a th:href="@{__${owner.id}__/pets/__${pet.id}__/visits/__${visit.id}__/edit}" class="btn btn-xs btn-primary">编辑</a>
                    <a th:href="@{__${owner.id}__/pets/__${pet.id}__/visits/__${visit.id}__/delete}" class="btn btn-xs btn-danger">删除</a>
                  </td>
                </tr>
                <tr th:if="${pet.visits.isEmpty() or !pet.visits.![vaccinationStatus].contains(null)}">
                  <td colspan="6" class="text-center">暂无疫苗接种记录</td>
                </tr>
              </tbody>
            </table>
            <a th:href="@{__${owner.id}__/pets/__${pet.id}__/visits/new}" class="btn btn-primary">添加疫苗接种记录</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Function to hide the success and error messages after 3 seconds
    function hideMessages() {
      setTimeout(function () {
        document.getElementById("success-message").style.display = "none";
        document.getElementById("error-message").style.display = "none";
      }, 3000); // 3000 milliseconds (3 seconds)
    }

    // Call the function to hide messages
    hideMessages();
  </script>

</body>


</html>